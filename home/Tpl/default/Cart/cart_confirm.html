<layout name='layout'/>

    <div id="dd-bz">
    	<div id="dd-bz-title">首页 >> <span style="color:#666;">我的购物车</span> >> <span style="color:#666;">确认订单信息</span></div>
        <div id="dd-tjddcg-bz3"><img src="../Public/image/27.png" /></div>
    </div>
    <form action="javascript:;" name="order_confirm" method="post">
<div id="xm-ddqr">
   	<div class="xm-ddqr1">收货信息</div>
        <div id="xm-ddqr2" class="new_address_insert" style="height:auto;">
              <div id="xm-xdz1">使用地址簿中的地址：</div>
              <volist name="my_addresss" id="vo_ad">
                <div id="xm-xdz2" style="margin:0 0 10px">
                      <ul>
                          <li style="margin-right:10px;">
                            <input index="<{$i-1}>" initiate_price="<{$vo_ad.logistics.initiate_price}>" average_price="<{$vo_ad.logistics.average_price}>" name="use_address" type="radio" value="<{$vo_ad.id}>" />
                          </li>
                          <li>
                            <strong><{$vo_ad.consignee}></strong> 
                            地址：
                            <{$vo_ad.where_text}>
                            <!-- 邮编：<{$vo_ad.zip}> -->
                            <notempty name="vo_ad.cellphone">手机：<{$vo_ad.cellphone}></notempty>
                            <notempty name="vo_ad.phone">电话：<{$vo_ad.phone}></notempty>
                            <a href="javascript:;" class="delete_address">  [删除]</a>
                          </li>
                      </ul>
                </div>
              </volist>
		</div>
    	<div class="xm-txxdz">
        	<ul>
            	<li class="xm-txxdz1"><span>*</span> 收货人姓名：</li>
                <li class="xm-txxdz2"><input name="consignee" type="text" /></li>
                <li class="xm-txxdz1"><span>*</span> 收货人地址：</li>
                <li class="xm-txxdz2">
                  <select name="information_province">
                        <option value="0">--请选择--</option>
                        <volist name="provice_level" id="vo_pl">
                            <option value="<{$vo_pl.id}>"><{$vo_pl.name}></option>
                        </volist>
                    </select>
                  <span id="information_city"></span>
                  <span id="information_county"></span>
                  <input type="hidden" name="where_id" />
                  <input type="hidden" name="where_text" />
                </li>
                <li class="xm-txxdz1"><span>*</span> 街道：</li>
                <li class="xm-txxdz2">
                  <input style="width:267px;" name="street" type="text" />
                </li>
                <!-- <li class="xm-txxdz1"><span>*</span> 邮编：</li>
                <li class="xm-txxdz2">
                  <input type="text" name="zip" />
                </li> -->
                <li class="xm-txxdz1"><span>*</span> 填写手机号：</li>
                <li class="xm-txxdz2">
                	<input type="text" name="cellphone" />
                   <span class="xm-mg10"> 座机（选填）：<input name="phone" type="text" /></span>
                </li>
                <li class="xm-txxdz3"><a href="javascript:;" id="add_address">确认收货地址</a></li>
            </ul>
      </div>
    <div class="xm-ddqr1">配送方式</div>
    <div class="xm-zffs" style="height:auto;">
    	<div class="xm-zffs1">
             <ul>
                <li><input name="delivery" type="radio" value="2" /></li>
                <li class="xm-mg10">送货上门安装（非电梯楼上楼费用由用户另付）</li>
             </ul>
        </div>
        <div class="xm-zffs1">
             <ul>
                <li><input name="delivery" type="radio" value="1" checked="checked" /></li>
                <li class="xm-mg10">提货点自提（用户到相应提货点自提安装）</li>
             </ul>
        </div>
        <div class="xm-zffs1">
        	物流费用：&#165;<span class="logistics">0.00</span>
        </div>
        <div class="xm-zffs1">
        	要求到货时间<input class="Wdate" readonly="readonly" name="ask_for_date" style="width:100px" type="text" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:'%y-%M-{%d+3}',onpicked:function(){ },oncleared:function(){}})" />以后
        </div>
        <div class="xm-zffs1">
        	有其他时间要求请与客服联系
        </div>
        <div class="xm-zffs1">
          <a href="__APP__/SupportCenter/index/id/88">请阅读物流详细介绍</a>
        </div>
<!--         <div class="xm-txxdz3"><a href="#">确认配送方式</a></div> -->
    </div>
    
    <div class="xm-ddqr1">支付方式</div>
    <div class="xm-psfs3" style="height:auto;">
        	<ul>
            	<li class="xm-psfs2" style="display:none">
                	<div>
                    	<ul>
                        	<li><input name="payment_model" type="radio" value="3" /></li>
                            <li class="xm-mg10">货到付款</li>
                        </ul>
                    </div>
                </li>
                <li class="xm-psfs1" style="display:none">快递可付现金、刷卡；</li>
                <li class="xm-psfs2" style="display:none">
               		 <div>
                    	<ul>
                        	<li><input name="payment_model" type="radio" value="2" /></li>
                            <li class="xm-mg10">银行电汇</li>
                           
                        </ul>
                    </div>
                </li>
                <li class="xm-psfs1" style="display:none">通过银行转账或现金直接存入指定帐号，需注明订单号。</li>
                <li class="xm-psfs2" style="width:auto">
               		 <div>
                  <label>
                    	<ul>
                        	<li><input name="payment_model" checked="checked" type="radio" value="1" style="display:none" /></li>
                          <li class="xm-mg10">通过网上银行或支付平台在线付款</li>
                        </ul>
                  </label>
                    </div>
                </li>                
                <li class="xm-psfs1">
                <!-- 通过网上银行或支付平台在线付款 -->
                  <ul style="margin-top:5px;display:none;margin-left:65px" id="child-payment">
                    <li style="clear:both;position:relative;top:-5px">
                      <label><input type="radio" name="payment" value="1" checked="checked" /> 支付宝支付</label>
                    </li>
                    <li style="clear:both;margin-top:5px">
                      <label><input type="radio" name="payment" value="2" /> 网上银行支付</label>
                    </li>
                  </ul>
                </li>
            </ul>
      </div>
      </form>
      <script type="text/javascript">
        $(function(){
          if($("[name=payment_model]:checked").val()==1){
            $("#child-payment").show();
          }
          $("[name=payment_model]").change(function(){
            if($(this).val()==1){
              $("#child-payment").show();
            }else{
              $("#child-payment").hide();
            }
          });
        });
      </script>
<!--        <div class="xm-ddqr1">发票信息</div>
       <div class="xm-fpxn" style="height:auto;">
        	<ul>
            	<li class="xm-txxdz1"><span>*</span> 发票类型：</li>
                <li class="xm-txxdz2">
                	<select name="invoice_type">
                  		<option value="商业零售发票">商业零售发票</option>
                	</select>
                 </li>
                <li class="xm-txxdz1"><span>*</span> 发票抬头：</li>
                <li class="xm-txxdz2">
                    <select name="invoice_rise">>
                      <option value="个人">个人</option>
                    </select>
                    <input name="invoice_info" class="xm-mg10" type="text" />
                </li>
            </ul>
      </div> -->
      
      <div class="xm-ddqr1" style="margin-top:10px">
      	<ul>
        	<li>商品清单</li>
          <li class="xm-fhxg"><a href="__APP__/Cart">返回购物车修改</a></li>
        </ul>
      </div>
    <div id="xm-spqd1">
      	<ul>
        	<li class="xm-spqd2" style="width:550px">商品</li>
            <li class="xm-spqd4">价格</li>
            <li class="xm-spqd5">购买数量</li>
            <li class="xm-spqd6">商品总价</li>
        </ul>
      </div>

      <volist name="Cartslist" id="vo_cl">
        <div class="xm-spqd7">
        	<ul>
          	<li class="xm-spqd2" style="width:550px">
                  <div>
                      <ul>
                          <li class="xm-spqd8"><a href="__APP__/<{$vo_cl.URL}>/details/id/<{$vo_cl.Commodity.id}>"><img src="__PUBLIC__/Content/<{$vo_cl.CIDir}>/thumb_<{$vo_cl.Commodity.image}>" width="90" height="58" /></a></li>
                          <li><a href="__APP__/<{$vo_cl.URL}>/details/id/<{$vo_cl.Commodity.id}>"><{$vo_cl.Commodity.name}></a></li>
                      </ul>
                  </div>
              </li>
              <li class="xm-spqd4">&#165;<span class="commodity-price"><{$vo_cl.Commodity.price}></span></li>
              <li class="xm-spqd5"><{$vo_cl.quantity}></li>
              <li class="xm-spqd6">&#165;<span class="commodity-xiaoji" xiaoji="<{$vo_cl.Commodity.price_all}>" ><{$vo_cl.Commodity.price_all}></span></li>
          </ul>
      </div>
    </volist>

    <div class="xm-ddqr1" style="margin-top:25px; ">订单结算</div>
    <div class="xm-ddqs-1">运费/服务费：<a >¥<span class="logistics">0.00</span></a></div>
    <eq name="Cartslist.0.type" value="1">
      <notempty name="youhui">
        <div class="xm-ddqs-2" style="width:auto;margin-left:749px">
          	<ul>
            	<li>使用<a style="color:#cc0000; font-size:12px;">满减</a>优惠卷</li>
                <li class="xm-mg10"><input name="coupon" type="checkbox" checked="checked" value="<{$youhui}>"  /></li>
                <li class="xm-mg10"> 优惠额：<span >&#165;<{$youhui}></span></li>
            </ul>
        </div>
      </notempty>
    </eq>
    <eq name="Cartslist.0.type" value="3">
      <notempty name="youhui">
        <div class="xm-ddqs-2" style="width:auto;margin-left:749px">
            <ul>
              <li>使用<a style="color:#cc0000; font-size:12px;">9折</a>优惠卷</li>
                <li class="xm-mg10"><input name="coupon" type="checkbox" checked="checked" value="<{$youhui}>"  /></li>
                <li class="xm-mg10"> 优惠额：<span >&#165;<{$youhui}></span></li>
            </ul>
        </div>
      </notempty>
    </eq>
      <input type="hidden" name="delivery_price" value="<{$Think.config.conf7|default="20"}>" />
      <input type="hidden" name="commodity_volume" value="<{$commodity_volume}>" />
      <input type="hidden" name="commodity_total" value="<{$commodity_total}>" />
      <input type="hidden" name="logistics" value="0" />
      <input type="hidden" name="price_total" value="<{$commodity_total}>" />
    <style type="text/css">
      .xm-ddqs-1{
        height:auto;
      }
    </style>
    <div class="xm-ddqs-1">产品金额共计：<a>：&#165;<span class="commodity-total" data="<{$commodity_total}>"><{$commodity_total}></span></a></div>
    <div class="xm-ddqs-1"><strong>您共需为订单支付：<span>¥<span id="price_total"><{$commodity_total}></span></span></strong></div>
    <div class="xm-ddqs-1"><strong>备注信息：</strong></div>
    <div class="xm-ddqs-1">
      <textarea name="remark" style="width:200px;height:50px;max-width:300px;max-height:100px;padding:2px;border:1px #dddddd solid"></textarea>
    </div>
    <div class="xm-ddqs-1 xm-cohui">-------------------------------------------------------------</div>
  	<div id="xm-qrzz-1"><input type="image" id="order_confirm" style="cursor:pointer;" src="../Public/image/39.jpg" width="150" height="45" /></div>
  </div>

<script>

    $(function(){

      $("[name=order_confirm]").submit(function(){

        if(!define_userid){
            window.location = define_app_url+'/Cat';
        }

        var s_a = $("[name=use_address]");

        var use_address = $("[name=use_address]:checked"); //地址
        var payment_model = $("[name=payment_model]:checked");//支付方式
        var payment = $("[name=payment]:checked"); //平台类型
        var delivery = $("[name=delivery]:checked"); //配送类型
        var ask_for_date = $("[name=ask_for_date]"); //要求到货日期
        // var invoice_type = $("[name=invoice_type]"); //发票信息
        // var invoice_rise = $("[name=invoice_rise]"); //发票信息
        // var invoice_info = $("[name=invoice_info]"); //发票信息
        var commodity_total = $("[name=commodity_total]"); //商品总价
        var price_total = $("[name=price_total]"); //订单总价
        var logistics = $("[name=logistics]"); //运费+服务费
        var delivery_price = $("[name=delivery_price]"); //服务费
        var coupon = $("[name=coupon]:checked"); //优惠金额
        var remark = $("[name=remark]"); //备注信息

        if(s_a.size()<1 || !s_a.val()){
          jBox.tip('请添加或选择收货地址', 'error',{ timeout: 2000});
          return false;
        }

        var ob = {
          use_address:use_address.val(),
          payment_model:payment_model.val(),
          payment:payment.val(),
          delivery:delivery.val(),
          ask_for_date:ask_for_date.val(),
          //invoice_type:invoice_type.val(),
          //invoice_rise:invoice_rise.val(),
          //invoice_info:invoice_info.val(),
          commodity_total:commodity_total.val(),
          price_total:price_total.val(),
          logistics:logistics.val(),
          delivery_price:delivery_price.val(),
          remark:remark.val(),
          coupon:parseInt(coupon.val() ? coupon.val() :0)
        };

          if(payment_model.val()==1){
              if(payment.val()==1){
                   var submit = function (v, h, f) {
                    if (v == 'ok'){

                        window.setTimeout(function () {

                           jBox.tip("正在处理...", 'loading');
                            $.ajax({
                                url: define_app_url+'/'+define_module_name+'/order_confirm',
                                data: ob,
                                type:'POST',
                                success: function(data){
                                    var msg = JSON.parse(data);
                                    if(msg.status==1){
 
                                      window.open(define_app_url+'/Pay/alipay_to_cart/out_trade_no/'+msg.data);

                                      window.setTimeout(function () {
                                        window.location=define_app_url+'/Cart/order_complete/out_trade_no/'+msg.data;
                                      },500);

                                    }else{
                                        jBox.tip(msg.info, 'error',{ timeout: 1000,closed: function () { }});
                                    }
                                }
                            });

                        },500);

                    }
                    return true; //close
                };

                jBox.confirm("确认提交订单，并跳转到支付页面？", "提示", submit,{top: '40%'});

              }else{
                console.log('网银支付');
              }
          }else{
            console.log('其它支付方式');
                  var submit = function (v, h, f) {
                    if (v == 'ok'){

                        window.setTimeout(function () {

                           jBox.tip("正在处理...", 'loading');
                            $.ajax({
                                url: define_app_url+'/'+define_module_name+'/order_confirm',
                                data: ob,
                                type:'POST',
                                success: function(data){
                                    var msg = JSON.parse(data);
                                    if(msg.status==1){
 
                                      window.setTimeout(function () {
                                        window.location=define_app_url+'/Cart/order_complete/out_trade_no/'+msg.data;
                                      },500);

                                    }else{
                                        jBox.tip(msg.info, 'error',{ timeout: 1000,closed: function () { }});
                                    }
                                }
                            });

                        },500);

                    }
                    return true; //close
                };

                jBox.confirm("确认提交订单？", "提示", submit,{top: '40%'});
          }
      });

    if($("[name=use_address]").size()>0){
        $("[name=use_address]").eq($("[name=use_address]").size()-1).attr('checked','checked');
        $(".logistics").text(get_logistics($("[name=use_address]").size()-1).toFixed(2));
        $("[name=logistics]").val(get_logistics($("[name=use_address]").size()-1));
    }

    $("[name=use_address]").change(function(){
        var i = $(this).attr('index'); 
        set_logistics(i);
    });

    function set_logistics(i){
        var gl = get_logistics(i);
    //    console.log(gl);
        var v = $("[name=delivery]:checked").val();
        var delivery_price = parseInt($("[name=delivery_price]").val());
     //   console.log(v);
        if(v==1){
          $(".logistics").text(gl.toFixed(2));
          $("[name=logistics]").val(gl);
        }else if(v==2){
          $(".logistics").text((gl+delivery_price).toFixed(2));
          $("[name=logistics]").val((gl+delivery_price));
        }
        get_totals();
    }

    $("[name=delivery]").change(function(){
        var v = $(this).val();
        var gl = get_logistics($("[name=use_address]:checked").attr('index'));
        var delivery_price = parseInt($("[name=delivery_price]").val());
        if(v==1){
          $(".logistics").text(gl.toFixed(2));
          $("[name=logistics]").val(gl);
        }else if(v==2){
          $(".logistics").text((gl+delivery_price).toFixed(2));
          $("[name=logistics]").val((gl+delivery_price));
        }
         get_totals();
    });

    $("[name=coupon]").click(function(){
       get_totals();
    });

    get_totals();

    function get_totals(){
        var lo = parseInt($("[name=logistics]").val());
        var total = parseInt($("[name=commodity_total]").val());
        var coupon = parseInt($("[name=coupon]:checked").val() ? $("[name=coupon]:checked").val() : 0);
        $("[name=price_total]").val(lo+total-coupon);
        $("#price_total").text((lo+total-coupon).toFixed(2));
    }

    function get_logistics(i){
      var addinit = $("[name=use_address]").eq(i);
      var initiate_price = parseInt(addinit.attr('initiate_price'));
      var average_price = parseInt(addinit.attr('average_price'));
      var commodity_volume = parseInt($("[name=commodity_volume]").val());
      var data = initiate_price+average_price*commodity_volume;
      if(data){
        return data;
      }else{
        return 0;
      }

    }

    $("[name=information_province]").live('change',function(){
        var v = $(this).val();
        var city = $("#information_city");
        var county = $("#information_county");
        city.html("");
        // $('<select name="information_city"><option value="0" style="background: #ccc;">--请选择--</option></select>').appendTo(city);
        $("[name=where_id]").val(v);
        if(v==0){
      city.html("");
            county.html("");
            $("[name=where_text]").val('');
        }else{
            $("[name=where_text]").val($(this).find("option:selected").text());
            $.ajax({
                url: define_app_url+'/Member/return_provinces',
                data: {pid:v},
                type:'POST',
                success: function(datas){
                    var obj = JSON.parse(datas);
          if(obj.length>0){
            city.html("");
            $('<select name="information_city"><option value="0" style="background: #ccc;">--请选择--</option></select>').appendTo(city);
            var citys = $("[name=information_city]");
            for(var i=0; i<obj.length; i++){
              $('<option value="'+obj[i].id+'">'+obj[i].name+'</option>').appendTo(citys);
            }
          }else{
            city.html("");
          }
                }
            });
        }
    });

    $("[name=information_city]").live('change',function(){
        var v = $(this).val();
        var county = $("#information_county");
        county.html("");
        if(v==0){
      county.html("");
            $("[name=where_id]").val($("[name=information_province]").val());
            $("[name=where_text]").val($("[name=information_province]").find("option:selected").text());
        }else{
      $("[name=where_id]").val(v);
            $("[name=where_text]").val($("[name=information_province]").find("option:selected").text()+' '+$(this).find("option:selected").text());
            $.ajax({
                url: define_app_url+'/Member/return_provinces',
                data: {pid:v},
                type:'POST',
                success: function(datas){
                    var obj = JSON.parse(datas);
          if(obj.length>0){
            county.html("");
            $('<select name="information_county"><option value="0" style="background: #ccc;">--请选择--</option></select>').appendTo(county);
            var countys = $("[name=information_county]");
            for(var i=0; i<obj.length; i++){
              $('<option value="'+obj[i].id+'">'+obj[i].name+'</option>').appendTo(countys);
            }
          }else{
            county.html("");
          }
                }
            });
        }
    });

    $("[name=information_county]").live('change',function(){
    var v = $(this).val();
    if(v!=0){
      $("[name=where_id]").val(v);
            $("[name=where_text]").val($("[name=information_province]").find("option:selected").text()+' '+$("[name=information_city]").find("option:selected").text()+' '+$(this).find("option:selected").text());
    }else{
            $("[name=where_id]").val($("[name=information_city]").val());
            $("[name=where_text]").val($("[name=information_province]").find("option:selected").text()+' '+$("[name=information_city]").find("option:selected").text());
        }
    });

    $("#add_address").click(function(){

        if($("[name=use_address]").size()>=10){
          jBox.tip('最多只能添加10个地址', 'error',{ timeout: 1000});
            return false;
        }

        var ics = $("[name=information_city]");
        var iccs = $("[name=information_county]");

        var consignee = $("[name=consignee]").val();
        var where_id = $("[name=where_id]").val();
        var street = $("[name=street]").val();
        // var zip = $("[name=zip]").val();
        var phone = $("[name=phone]").val();
        var cellphone = $("[name=cellphone]").val();
        var where_text = $("[name=where_text]").val();

        if(consignee=='' || !/[\u4e00-\u9fa5]+/.test(consignee) || consignee.length<2){
            jBox.tip('请填写收货人姓名', 'error',{ timeout: 1000});
            return false;
        }
         if(where_id=='' || where_id==0){
            jBox.tip('请选择所在城市', 'error',{ timeout: 1000});
            return false;
        }

        if(ics.find('option').size()>0 && ics.val()==0){
            jBox.tip('请选择所在城市', 'error',{ timeout: 1000});
            return false;
        }

        if(iccs.find('option').size()>0 && iccs.val()==0){
            jBox.tip('请选择所在城市', 'error',{ timeout: 1000});
            return false;
        }

        if(street==''){
            jBox.tip('请填写街道地址', 'error',{ timeout: 1000});
            return false;
        }
        if(street==''){
            jBox.tip('邮编不能为空', 'error',{ timeout: 1000});
            return false;
        }
        // if(zip=='' || isNaN(zip) || zip.length<6){
        //     jBox.tip('请输入正确的邮编', 'error',{ timeout: 1000});
        //     return false;
        // }

        if(cellphone.length<11 || cellphone.length>11 || cellphone[0]!=1 || cellphone[1]==2){
            jBox.tip("请输入正确的手机号码", 'error',{ timeout: 1000,closed: function () {  }});
            return false;
        }

        if(phone!=''){
            if(isNaN(phone) || phone.length<7){
                jBox.tip('请填写正确的座机号码', 'error',{ timeout: 1000});
                return false;
            }
        }

        //var ob = {consignee:consignee,where_id:where_id,street:street,zip:zip,cellphone:cellphone,phone:phone,where_text:where_text}
        var ob = {consignee:consignee,where_id:where_id,street:street,cellphone:cellphone,phone:phone,where_text:where_text}
        jBox.tip("正在处理...", 'loading');
        $.ajax({
            url: define_app_url+'/'+define_module_name+'/insert_address',
            data: ob,
            type:'POST',
            success: function(data){
                var msg = JSON.parse(data);
                if(msg.status==1){

                    // var ht = '<div id="xm-xdz2" style="margin:0 0 10px"><ul><li style="margin-right:10px;"><input  index="'+$("[name=use_address]").size()+'" initiate_price="'+msg.data.initiate_price+'" average_price="'+msg.data.average_price+'" name="use_address" type="radio" value="'+msg.data.id+'" /></li><li><strong>'+consignee+'</strong> 地址：'+where_text+' 邮编：'+zip+' '+(cellphone ? '手机：'+cellphone : '')+' '+(phone ? '电话：'+phone : '')+'<a href="javascript:;" class="delete_address">  [删除]</a></li></ul></div>';
                     var ht = '<div id="xm-xdz2" style="margin:0 0 10px"><ul><li style="margin-right:10px;"><input  index="'+$("[name=use_address]").size()+'" initiate_price="'+msg.data.initiate_price+'" average_price="'+msg.data.average_price+'" name="use_address" type="radio" value="'+msg.data.id+'" /></li><li><strong>'+consignee+'</strong> 地址：'+where_text+' '+(cellphone ? '手机：'+cellphone : '')+' '+(phone ? '电话：'+phone : '')+'<a href="javascript:;" class="delete_address">  [删除]</a></li></ul></div>';

                    var ap = $(".new_address_insert");
                    ap.append(ht);
                    $("[name=use_address]").removeAttr('checked');
                    $("[name=use_address]").eq($("[name=use_address]").size()-1).attr('checked','checked');
                    set_logistics($("[name=use_address]").size()-2);
                    jBox.close();
                    jBox.tip(msg.info, 'success',{ timeout: 1000,closed: function () {
                        $("[name=information_province]").val(0);
                        $("#information_city").html('');
                        $("#information_county").html('');
                        $("[name=consignee]").val('');
                        $("[name=where_id]").val('');
                        $("[name=street]").val('');
                        // $("[name=zip]").val('');
                        $("[name=phone]").val('');
                        $("[name=cellphone]").val('');
                        $("[name=where_text]").val('');
                    }});
                }else{
                    jBox.tip(msg.info, 'error',{ timeout: 1000});
                }
            }
        });
    });

    $(".delete_address").live('click',function(){
        if($("[name=use_address]").size()<=1){
            jBox.tip('至少有一个地址!', 'error',{ timeout: 2000});
            return false;
        }
        var self = $(this);
        var id = self.parents('#xm-xdz2').find("[name=use_address]").val();
        if(id){
          var deleteid = [];
          deleteid.push(id);
          var submit = function (v, h, f) {
              if (v == 'ok'){
                  jBox.tip("正在处理...", 'loading');
                  $.ajax({
                      url: define_app_url+'/'+define_module_name+'/delete_address',
                      data: {deleteid:deleteid},
                      type:'POST',
                      success: function(data){
                          var msg = JSON.parse(data);
                          if(msg.status==1){
                              self.parents('#xm-xdz2').remove();
                              $("[name=use_address]").removeAttr('checked');
                              $("[name=use_address]").eq($("[name=use_address]").size()-1).attr('checked','checked');
                              set_logistics($("[name=use_address]").size()-1);
                              jBox.tip(msg.info, 'success',{ timeout: 1000,closed: function () { }});
                          }else{
                              jBox.tip(msg.info, 'error',{ timeout: 1000,closed: function () { }});
                          }
                      }
                  });
              }
              return true; //close
          };
          jBox.confirm("确认删除这个地址？", "提示", submit,{top: '40%'});
      }
    });

  });

</script>